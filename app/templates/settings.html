{% extends 'index.html' %}


{% block app_content %}    
    <div class="form-group">        
        <h4><strong>Общие настройки</strong></h4>        
        <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#1">Начальные настройки</a></li>            
            <li><a data-toggle="tab" href="#2">Актуальность баз</a></li>
        </ul>
        <div class="tab-content">
            <div id="1" class="tab-pane fade in active">                
                <h4>Внимание!</h4>
                <p>Установка интервала необходима для проверки результатов расчета в базе 1С (по умолчанию 10 мин).</p>                
                <div class="panel-group" id="accordion">
                    {% for id, settings in data.items()|sort %}
                        {% set id = id[-3:] %}
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse_{{ id }}">{{ settings.basename }}</a>
                                </h4>
                            </div>
                            <div id="collapse_{{ id }}" class="panel-collapse collapse">
                                <div class="panel-body">
                                    <div class="col-xs-4">                                        
                                        <div class="form-group">
                                            <label>Интервал проверки (мин):</label>
                                            <input id="settings_interval_{{ id }}" type="text" maxlength="3" class="form-control" value="{{ settings.interval }}">
                                        </div>                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}                    
                </div>                          
            </div>            
            <div id="2" class="tab-pane fade">
                <h4>Внимание!</h4>
                <p>Для ускорения работы сайта данные из баз кэшируются. В кэш заносятся "Настройки пользователей" и "Период расчета(дата запрета редактирования)".</p>
                <p>При нажатии на кнопку кэш очищается.</p>
                <div class="panel panel-default">
                    <!-- Default panel contents -->
                    <div class="panel-heading"></div>    
                    <!-- List group -->
                    <ul id="list-group_cache" class="list-group">
                        {% for id, settings in data.items()|sort %}
                            {% set id = id[-3:] %}
                            <li class="list-group-item">
                                {{ settings.basename }}                                
                                <div class="material-switch pull-right">
                                    <input id="switch_option_actual_{{ id }}" type="checkbox"/>
                                    <label for="switch_option_actual_{{ id }}" class="label-success"></label>
                                </div>
                            </li>
                        {% endfor %}                        
                    </ul>
                </div>                
            </div>            
        </div>        
    </div>    
{% endblock %} 

{% block app_scripts %}    
    <!-- <script src="{{ url_for('static', filename='jq/jquery.maskedinput.js') }}"></script> -->
    <script>
        // $.mask.definitions['9'] = '';        
        // $('#settings_host').mask('192.168.***.*');        
        $('#list-group_cache input:checkbox').prop('checked', false)

        $('input[type=text]').on('change', function () {            
            var
                $this = $(this),                
                _interval = '',
                _db,                
                _str;
                            
            _str      = $this.attr('id');
            _db       = _str.substring(_str.length-3, _str.length);
            _interval = $this.val();            
            $.post('{{ url_for("main.save") }}', {db: _db, interval: _interval})
                .done()
                .fail( function(response) {console.log(response);})            
        })        
    </script>   
{% endblock %}